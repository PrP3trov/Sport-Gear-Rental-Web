@model IEnumerable<SportGearRental.ViewModels.Review.ReviewViewModel>
@using System.Linq

@section Styles {
    <link rel="stylesheet" href="~/css/review-index.css" />
}


<div class="reviews-container">
    @if (Model != null && Model.Any())
    {
        <div class="reviews-header">
            <div class="reviews-stats">
                <div class="stat-item">
                    <div class="stat-number">@Model.Count()</div>
                    <div class="stat-label">Отзива</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">@(Model.Any() ? Model.Average(r => r.Rating).ToString("F1") : "0")</div>
                    <div class="stat-label">Средна оценка</div>
                </div>
                <div class="stat-item">
                    <div class="rating-display">
                        @{
                            var avgRating = Model.Any() ? Model.Average(r => r.Rating) : 0;
                        }
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Math.Floor(avgRating))
                            {
                                <i class="fas fa-star filled"></i>
                            }
                            else if (i <= Math.Ceiling(avgRating))
                            {
                                <i class="fas fa-star-half-alt filled"></i>
                            }
                            else
                            {
                                <i class="far fa-star"></i>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="reviews-list">
            @foreach (var review in Model.OrderByDescending(r => r.Rating))
            {
                <div class="review-card">
                    <div class="review-header">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <h4 class="user-name">@review.UserName</h4>
                                <div class="review-rating">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= review.Rating)
                                        {
                                            <i class="fas fa-star filled"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-star empty"></i>
                                        }
                                    }
                                    <span class="rating-number">(@review.Rating/5)</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-badge">
                            <i class="fas fa-quote-right"></i>
                        </div>
                    </div>

                    <div class="review-content">
                        <p>@review.Content</p>
                    </div>

                    <div class="review-footer">
                        <div class="review-meta">
                            <i class="fas fa-clock"></i>
                            <span>Преди няколко дни</span>
                        </div>
                        <div class="helpful-section">
                            <button class="helpful-btn" type="button">
                                <i class="fas fa-thumbs-up"></i>
                                Полезно
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="rating-distribution">
            <h4>Разпределение на оценките</h4>
            @for (int star = 5; star >= 1; star--)
            {
                var count = Model.Count(r => r.Rating == star);
                var percentage = Model.Any() ? (double)count / Model.Count() * 100 : 0;

                <div class="rating-bar">
                    <span class="rating-label">@star ⭐</span>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: @percentage%"></div>
                    </div>
                    <span class="rating-count">@count</span>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-reviews">
            <div class="empty-icon">
                <i class="fas fa-comments"></i>
            </div>
            <h3>Все още няма отзиви</h3>
            <p>Бъдете първият, който ще сподели мнението си за тази екипировка!</p>
            <div class="empty-stars">
                @for (int i = 1; i <= 5; i++)
                {
                    <i class="far fa-star empty-star"></i>
                }
            </div>
        </div>
    }
</div>